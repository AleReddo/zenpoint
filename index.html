
<!-- ðŸ”Ž Barra filtri stile Osmogenova -->
<style>
  .filter-bar {
    background-color: #f5f5f5;
    padding: 1rem;
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
    justify-content: center;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  }

  .filter-bar input,
  .filter-bar select {
    padding: 0.6rem 1rem;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 1rem;
    font-family: "Helvetica Neue", sans-serif;
    min-width: 200px;
  }

  .filter-bar button {
    padding: 0.6rem 1.2rem;
    background-color: #2466a8;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    font-size: 1rem;
  }

  .filter-bar button:hover {
    background-color: #1a4d7e;
  }
</style>

<div class="filter-bar">
  <input type="text" id="user-city" placeholder="La tua cittÃ  (es. Belluno)" />
  <select id="profession-filter">
    <option value="">Tutte le professioni</option>
    <option value="PT">PT</option>
    <option value="Massaggiatore">Massaggiatore</option>
    <option value="Fisioterapista">Fisioterapista</option>
    <option value="Estetista">Estetista</option>
  </select>
  <select id="service-filter">
    <option value="">Tutti i servizi</option>
    <option value="PT">PT</option>
    <option value="Massaggiatore">Massaggiatore</option>
    <option value="Fisioterapista">Fisioterapista</option>
    <option value="Estetista">Estetista</option>
  </select>
  <select id="radius-filter">
    <option value="10">10 km</option>
    <option value="20">20 km</option>
    <option value="50">50 km</option>
    <option value="100">100 km</option>
  </select>
  <button onclick="applyFilters()">Applica filtri</button>
</div>

<script>
  async function getCoordinatesFromCity(city) {
    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`);
    const results = await response.json();
    if (results.length === 0) return null;
    return {
      lat: parseFloat(results[0].lat),
      lng: parseFloat(results[0].lon),
    };
  }

  function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = ((lat2 - lat1) * Math.PI) / 180;
    const dLon = ((lon2 - lon1) * Math.PI) / 180;
    const a =
      Math.sin(dLat / 2) * Math.sin(dLat / 2) +
      Math.cos((lat1 * Math.PI) / 180) *
        Math.cos((lat2 * Math.PI) / 180) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }

  async function applyFilters() {
    const city = document.getElementById("user-city").value.trim();
    const profession = document.getElementById("profession-filter").value;
    const service = document.getElementById("service-filter").value;
    const radius = parseInt(document.getElementById("radius-filter").value);

    if (!city) {
      alert("Inserisci la tua cittÃ  per applicare i filtri.");
      return;
    }

    const userCoords = await getCoordinatesFromCity(city);
    if (!userCoords) {
      alert("CittÃ  non trovata. Controlla il nome.");
      return;
    }

    fetch("professionisti.json")
      .then((res) => res.json())
      .then((data) => {
        const filtered = data.filter((p) => {
          if (!p.lat || !p.lng) return false;
          const distance = calculateDistance(userCoords.lat, userCoords.lng, p.lat, p.lng);
          if (distance > radius) return false;
          if (profession && p.professione !== profession) return false;
          if (service && p.professione !== service) return false;
          return true;
        });

        const listContainer = document.getElementById("professionisti-list");
        listContainer.innerHTML = "";

        filtered.forEach((p) => {
          const slug = p.nome.toLowerCase().replace(/ /g, "-");
          const listItem = document.createElement("li");
          listItem.innerHTML = `
            <strong>${p.nome}</strong> - ${p.professione} - ${p.citta}<br>
            <a href="${slug}.html">Leggi o scrivi una recensione</a>
          `;
          listContainer.appendChild(listItem);
        });
      });
  }
</script>
